From d80a5bd72dbe6b848916bcc2563647af1b50b9c6 Mon Sep 17 00:00:00 2001
From: Root <root@gentoo.local>
Date: Wed, 29 Jul 2020 05:44:43 +0200
Subject: [PATCH 1/3] ldflags

---
 CMakeLists.txt | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 6bb795196..5dcc310b7 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -341,11 +341,10 @@ if( CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang" )
 
     elseif( NOT APPLE )
         # Thou shalt not link vaporware and tell us it's a valid DSO (apple ld doesn't support it)
-        # temporarily disabled due to breaking ASAN-enabled builds - Tom
-        # set( CMAKE_SHARED_LINKER_FLAGS "-Wl,--no-undefined" )
-        # set( CMAKE_MODULE_LINKER_FLAGS "-Wl,--no-undefined" )
+        set( CMAKE_SHARED_LINKER_FLAGS "$ENV{LDFLAGS} -Wl,--no-undefined" )
+        set( CMAKE_MODULE_LINKER_FLAGS "$ENV{LDFLAGS} -Wl,--no-undefined" )
 
-        set( CMAKE_EXE_LINKER_FLAGS_RELEASE "-s" )
+        set( CMAKE_EXE_LINKER_FLAGS_RELEASE "$ENV{LDFLAGS} -s" )
     endif()
 
     if( APPLE )
-- 
2.27.0

